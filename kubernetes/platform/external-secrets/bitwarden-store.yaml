apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: bitwarden-tls-certs
spec:
  secretName: bitwarden-tls-certs
  dnsNames:
  - bitwarden-sdk-server.external-secrets.svc.cluster.local
  - external-secrets-bitwarden-sdk-server.external-secrets.svc.cluster.local
  - localhost
  ipAddresses:
  - 127.0.0.1
  - ::1
  privateKey:
    algorithm: RSA
    encoding: PKCS8
    size: 2048
  issuerRef:
    name: bitwarden
    kind: ClusterIssuer
---
apiVersion: external-secrets.io/v1
kind: ClusterSecretStore
metadata:
  name: bitwarden
spec:
  provider:
    bitwardensecretsmanager:
      apiURL: https://api.bitwarden.com
      identityURL: https://identity.bitwarden.com
      auth:
        secretRef:
          credentials:
            key: token
            name: bitwarden
            namespace: external-secrets
      bitwardenServerSDKURL: https://bitwarden-sdk-server.external-secrets.svc.cluster.local:9998
      caProvider:
        type: Secret
        name: bitwarden-tls-certs
        key: ca.crt
        namespace: external-secrets
      organizationID: fc32290b-66fc-48b3-a734-b37800bcfb53
      projectID: 4bceaa73-37aa-4403-845d-b37800bdc7b3
